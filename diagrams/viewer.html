<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RabbitMQ Order Cancellation - Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        h1 {
            color: #4f46e5;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #6b7280;
            font-size: 16px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #4b5563;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tab-btn:hover {
            background: #4f46e5;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .tab-btn.active {
            background: #4f46e5;
            color: white;
        }

        .diagram-container {
            display: none;
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .diagram-container.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .diagram-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .diagram-header h2 {
            color: #111827;
            font-size: 24px;
            margin-bottom: 8px;
        }

        .diagram-header p {
            color: #6b7280;
            font-size: 14px;
        }

        .diagram-content {
            display: flex;
            justify-content: center;
            padding: 20px;
            background: #f9fafb;
            border-radius: 12px;
            overflow-x: auto;
        }

        .actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-primary:hover {
            background: #4338ca;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
        }

        .mermaid {
            background: white;
        }

        /* Loading animation */
        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .spinner {
            border: 3px solid #e5e7eb;
            border-top: 3px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üê∞ RabbitMQ Order Cancellation System</h1>
            <p class="subtitle">Architecture & Flow Diagrams - Interactive Viewer</p>
        </header>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showDiagram('order-flow')">
                üìä Lu·ªìng x·ª≠ l√Ω
            </button>
            <button class="tab-btn" onclick="showDiagram('architecture')">
                üèóÔ∏è Ki·∫øn tr√∫c
            </button>
            <button class="tab-btn" onclick="showDiagram('sequence-payment')">
                ‚úÖ Thanh to√°n
            </button>
            <button class="tab-btn" onclick="showDiagram('sequence-cancel')">
                ‚è∞ T·ª± ƒë·ªông h·ªßy
            </button>
            <button class="tab-btn" onclick="showDiagram('state')">
                üîÑ State Machine
            </button>
            <button class="tab-btn" onclick="showDiagram('timeline')">
                ‚è±Ô∏è Timeline
            </button>
            <button class="tab-btn" onclick="showDiagram('rabbitmq')">
                üê∞ RabbitMQ Config
            </button>
        </div>

        <!-- Order Flow Diagram -->
        <div id="order-flow" class="diagram-container active">
            <div class="diagram-header">
                <h2>üìä Lu·ªìng x·ª≠ l√Ω ƒë∆°n h√†ng</h2>
                <p>Flowchart t·ªïng quan v·ªÅ to√†n b·ªô lu·ªìng t·ª´ t·∫°o ƒë∆°n ‚Üí thanh to√°n/h·ªßy</p>
            </div>
            <div class="diagram-content">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>ƒêang t·∫£i diagram...</p>
                </div>
            </div>
        </div>

        <!-- Architecture Diagram -->
        <div id="architecture" class="diagram-container">
            <div class="diagram-header">
                <h2>üèóÔ∏è Ki·∫øn tr√∫c h·ªá th·ªëng</h2>
                <p>Component diagram hi·ªÉn th·ªã c√°c layer v√† components</p>
            </div>
            <div class="diagram-content">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>ƒêang t·∫£i diagram...</p>
                </div>
            </div>
        </div>

        <!-- Sequence Payment -->
        <div id="sequence-payment" class="diagram-container">
            <div class="diagram-header">
                <h2>‚úÖ Sequence - Thanh to√°n th√†nh c√¥ng</h2>
                <p>Sequence diagram cho scenario thanh to√°n th√†nh c√¥ng</p>
            </div>
            <div class="diagram-content">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>ƒêang t·∫£i diagram...</p>
                </div>
            </div>
        </div>

        <!-- Sequence Cancel -->
        <div id="sequence-cancel" class="diagram-container">
            <div class="diagram-header">
                <h2>‚è∞ Sequence - T·ª± ƒë·ªông h·ªßy</h2>
                <p>Sequence diagram cho scenario t·ª± ƒë·ªông h·ªßy sau timeout</p>
            </div>
            <div class="diagram-content">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <!-- State Diagram -->
        <div id="state" class="diagram-container">
            <div class="diagram-header">
                <h2>üîÑ State Machine</h2>
                <p>State diagram cho c√°c tr·∫°ng th√°i ƒë∆°n h√†ng</p>
            </div>
            <div class="diagram-content">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>ƒêang t·∫£i diagram...</p>
                </div>
            </div>
        </div>

        <!-- Timeline -->
        <div id="timeline" class="diagram-container">
            <div class="diagram-header">
                <h2>‚è±Ô∏è Timeline v√≤ng ƒë·ªùi ƒë∆°n h√†ng</h2>
                <p>Timeline diagram theo th·ªùi gian th·ª±c</p>
            </div>
            <div class="diagram-content">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>ƒêang t·∫£i diagram...</p>
                </div>
            </div>
        </div>

        <!-- RabbitMQ Config -->
        <div id="rabbitmq" class="diagram-container">
            <div class="diagram-header">
                <h2>üê∞ C·∫•u h√¨nh RabbitMQ</h2>
                <p>Chi ti·∫øt exchanges, queues, bindings</p>
            </div>
            <div class="diagram-content">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>ƒêang t·∫£i diagram...</p>
                </div>
            </div>
        </div>

        <footer>
            <p>üöÄ RabbitMQ Order Cancellation System</p>
            <p style="margin-top: 10px; font-size: 14px; opacity: 0.8;">
                Diagrams created with Mermaid | View on 
                <a href="https://github.com/tranchiencongtd/rabbitmq-spring-boot" 
                   style="color: white; text-decoration: underline;">GitHub</a>
            </p>
        </footer>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Diagram definitions (populated from .mmd files)
        const diagrams = {
            'order-flow': `flowchart TD
    Start([Kh√°ch h√†ng t·∫°o ƒë∆°n h√†ng]) --> CreateOrder[API: POST /api/orders/create]
    CreateOrder --> GenerateOrder[T·∫°o Order Object<br/>orderId = UUID<br/>status = PENDING]
    GenerateOrder --> SendPending[Producer g·ª≠i message<br/>ƒë·∫øn order.pending.queue]
    SendPending --> QueuePending[(order.pending.queue<br/>TTL = 15 ph√∫t)]
    
    QueuePending --> ConsumerPending[Consumer nh·∫≠n message<br/>handlePendingOrder]
    ConsumerPending --> SaveDB[(L∆∞u v√†o Database)]
    ConsumerPending --> SendEmail[G·ª≠i email nh·∫Øc nh·ªü<br/>thanh to√°n]
    
    QueuePending --> Decision{Kh√°ch h√†ng<br/>l√†m g√¨?}
    
    Decision -->|Thanh to√°n trong 15 ph√∫t| PayAPI[API: POST /orders/:id/pay]
    PayAPI --> SendPaid[Producer g·ª≠i message<br/>ƒë·∫øn order.paid.queue]
    SendPaid --> QueuePaid[(order.paid.queue)]
    QueuePaid --> ConsumerPaid[Consumer nh·∫≠n message<br/>handlePaidOrder]
    ConsumerPaid --> UpdatePaid[C·∫≠p nh·∫≠t status = PAID]
    UpdatePaid --> ProcessShipping[X·ª≠ l√Ω ƒë√≥ng g√≥i<br/>v√† giao h√†ng]
    ProcessShipping --> EndPaid([K·∫øt th√∫c - ƒê√£ thanh to√°n])
    
    Decision -->|H·ªßy th·ªß c√¥ng| CancelAPI[API: POST /orders/:id/cancel]
    CancelAPI --> SendCancelled[Producer g·ª≠i message<br/>ƒë·∫øn order.cancelled.queue]
    SendCancelled --> QueueCancelled[(order.cancelled.queue)]
    
    Decision -->|Kh√¥ng l√†m g√¨ - H·∫øt 15 ph√∫t| ExpireMessage[Message expire]
    ExpireMessage --> DLX[Dead Letter Exchange<br/>order.dlx.exchange]
    DLX --> RouteToCancelled[Route v·ªõi key<br/>order.cancelled]
    RouteToCancelled --> QueueCancelled
    
    QueueCancelled --> ConsumerCancelled[Consumer nh·∫≠n message<br/>handleCancelledOrder]
    ConsumerCancelled --> CheckStatus{Status<br/>ƒë√£ PAID?}
    CheckStatus -->|C√≥| IgnoreCancel[B·ªè qua h·ªßy ƒë∆°n]
    IgnoreCancel --> EndIgnore([K·∫øt th√∫c - Gi·ªØ PAID])
    CheckStatus -->|Kh√¥ng| UpdateCancelled[C·∫≠p nh·∫≠t status = CANCELLED]
    UpdateCancelled --> RestoreStock[Ho√†n tr·∫£ h√†ng v·ªÅ kho]
    RestoreStock --> NotifyCustomer[G·ª≠i email th√¥ng b√°o h·ªßy]
    NotifyCustomer --> EndCancelled([K·∫øt th√∫c - ƒê√£ h·ªßy])
    
    style Start fill:#4f46e5,color:#fff
    style EndPaid fill:#10b981,color:#fff
    style EndCancelled fill:#ef4444,color:#fff
    style EndIgnore fill:#10b981,color:#fff
    style QueuePending fill:#fef3c7,stroke:#f59e0b,stroke-width:3px
    style QueuePaid fill:#d1fae5,stroke:#10b981,stroke-width:3px
    style QueueCancelled fill:#fee2e2,stroke:#ef4444,stroke-width:3px
    style DLX fill:#fca5a5,stroke:#991b1b,stroke-width:3px
    style Decision fill:#dbeafe,stroke:#3b82f6,stroke-width:3px`,

            'architecture': `graph TB
    subgraph "CLIENT LAYER"
        Client[Client Application<br/>Web UI / Mobile App]
    end
    
    subgraph "API LAYER"
        Controller[OrderController<br/>REST API Endpoints]
        Service[OrderService<br/>Business Logic]
    end
    
    subgraph "MESSAGING LAYER"
        Producer[OrderProducer<br/>Send Messages]
        Consumer[OrderConsumer<br/>Receive Messages]
    end
    
    subgraph "RABBITMQ BROKER"
        Exchange[order.exchange<br/>Direct Exchange]
        DLX[order.dlx.exchange<br/>Dead Letter Exchange]
        
        subgraph "QUEUES"
            PendingQ[(order.pending.queue<br/>TTL: 15 min<br/>DLX: order.dlx.exchange)]
            PaidQ[(order.paid.queue)]
            CancelledQ[(order.cancelled.queue)]
        end
    end
    
    subgraph "DATA LAYER"
        DB[(Database<br/>Order Storage)]
    end
    
    subgraph "NOTIFICATION LAYER"
        Email[Email Service<br/>Send Notifications]
    end
    
    Client -->|HTTP Request| Controller
    Controller --> Service
    Service --> Producer
    
    Producer -->|order.pending| Exchange
    Producer -->|order.paid| Exchange
    Producer -->|order.cancelled| Exchange
    
    Exchange -->|routing: order.pending| PendingQ
    Exchange -->|routing: order.paid| PaidQ
    
    PendingQ -->|Message Expire| DLX
    DLX -->|routing: order.cancelled| CancelledQ
    
    PendingQ -->|Listen| Consumer
    PaidQ -->|Listen| Consumer
    CancelledQ -->|Listen| Consumer
    
    Consumer --> DB
    Consumer --> Email
    
    style Client fill:#dbeafe,stroke:#3b82f6,stroke-width:2px
    style Exchange fill:#fbbf24,stroke:#f59e0b,stroke-width:2px
    style DLX fill:#ef4444,color:#fff,stroke:#991b1b,stroke-width:3px
    style PendingQ fill:#fef3c7,stroke:#f59e0b,stroke-width:3px
    style PaidQ fill:#d1fae5,stroke:#10b981,stroke-width:3px
    style CancelledQ fill:#fee2e2,stroke:#ef4444,stroke-width:3px`,

            'sequence-payment': `sequenceDiagram
    participant C as Kh√°ch h√†ng
    participant API as REST API
    participant P as Producer
    participant Q as RabbitMQ
    participant CON as Consumer
    participant DB as Database
    
    Note over C,DB: SCENARIO 1: THANH TO√ÅN TH√ÄNH C√îNG
    
    C->>+API: POST /api/orders/create
    API->>API: T·∫°o Order (status=PENDING)
    API->>+P: sendOrderToPending()
    P->>+Q: G·ª≠i message v√†o pending queue (TTL=15min)
    Q-->>-P: ACK
    P-->>-API: Success
    API-->>-C: Response: orderId, TTL info
    
    Q->>+CON: Deliver message
    CON->>DB: L∆∞u order
    CON->>C: G·ª≠i email nh·∫Øc nh·ªü
    CON-->>-Q: ACK
    
    Note over C,DB: Kh√°ch h√†ng thanh to√°n trong 15 ph√∫t
    
    C->>+API: POST /api/orders/{id}/pay
    API->>API: Ki·ªÉm tra status
    API->>+P: sendOrderToPaid()
    P->>+Q: G·ª≠i message v√†o paid queue
    Q-->>-P: ACK
    P-->>-API: Success
    API-->>-C: Response: Thanh to√°n th√†nh c√¥ng
    
    Q->>+CON: Deliver message (paid queue)
    CON->>DB: Update status = PAID
    CON->>C: G·ª≠i email x√°c nh·∫≠n
    CON-->>-Q: ACK
    
    Note over Q: Message trong pending queue expire
    Q->>+CON: Deliver expired message
    CON->>CON: Ki·ªÉm tra status = PAID
    CON->>CON: B·ªè qua h·ªßy ƒë∆°n
    CON-->>-Q: ACK
    
    Note over C,DB: K·∫øt qu·∫£: ƒê∆°n h√†ng = PAID ‚úÖ`,

            'sequence-cancel': `sequenceDiagram
    participant C as Kh√°ch h√†ng
    participant API as REST API
    participant P as Producer
    participant Q as RabbitMQ
    participant CON as Consumer
    participant DB as Database
    
    Note over C,DB: SCENARIO 2: T·ª∞ ƒê·ªòNG H·ª¶Y (TIMEOUT)
    
    C->>+API: POST /api/orders/create
    API->>API: T·∫°o Order (status=PENDING)
    API->>+P: sendOrderToPending()
    P->>+Q: G·ª≠i message v√†o pending queue (TTL=15min)
    Note right of Q: TTL Timer b·∫Øt ƒë·∫ßu: 15:00
    Q-->>-P: ACK
    P-->>-API: Success
    API-->>-C: Response: orderId, TTL info
    
    Q->>+CON: Deliver message
    CON->>DB: L∆∞u order
    CON->>C: G·ª≠i email nh·∫Øc nh·ªü
    CON-->>-Q: ACK
    
    Note over C,Q: ‚è∞ Timer ƒë·∫øm ng∆∞·ª£c: 15:00 ‚Üí 00:00
    Note over C,Q: Kh√°ch h√†ng KH√îNG thanh to√°n
    
    Note right of Q: TTL h·∫øt h·∫°n: 00:00
    Q->>Q: Message EXPIRE
    Q->>Q: Chuy·ªÉn sang Dead Letter Exchange
    Note right of Q: DLX: order.dlx.exchange<br/>Routing: order.cancelled
    
    Q->>+CON: Deliver expired message (cancelled queue)
    CON->>CON: Ki·ªÉm tra status != PAID
    CON->>DB: Update status = CANCELLED
    CON->>DB: C·∫≠p nh·∫≠t cancelledAt, cancelReason
    CON->>DB: Ho√†n tr·∫£ h√†ng v·ªÅ kho
    CON->>C: G·ª≠i email th√¥ng b√°o h·ªßy
    CON-->>-Q: ACK
    
    Note over C,DB: K·∫øt qu·∫£: ƒê∆°n h√†ng = CANCELLED ‚ùå<br/>L√Ω do: "H·ªßy t·ª± ƒë·ªông do qu√° th·ªùi gian thanh to√°n"`,

            'state': `stateDiagram-v2
    [*] --> PENDING: T·∫°o ƒë∆°n h√†ng m·ªõi
    
    PENDING --> PAID: Thanh to√°n th√†nh c√¥ng<br/>(POST /orders/:id/pay)
    PENDING --> CANCELLED: H·ªßy th·ªß c√¥ng<br/>(POST /orders/:id/cancel)
    PENDING --> CANCELLED: T·ª± ƒë·ªông h·ªßy<br/>(TTL expire sau 15 ph√∫t)
    
    PAID --> [*]: ƒê∆°n h√†ng ho√†n t·∫•t
    CANCELLED --> [*]: ƒê∆°n h√†ng k·∫øt th√∫c
    
    note right of PENDING
        Timer: 15 ph√∫t
        Message trong: order.pending.queue
        Actions: Ch·ªù thanh to√°n
    end note
    
    note right of PAID
        Message trong: order.paid.queue
        Actions: ƒê√≥ng g√≥i, giao h√†ng
    end note
    
    note right of CANCELLED
        Message trong: order.cancelled.queue
        Actions: Ho√†n tr·∫£ kho, th√¥ng b√°o
        L√Ω do: Manual / Auto timeout
    end note`,

            'timeline': `timeline
    title Timeline: V√≤ng ƒë·ªùi ƒë∆°n h√†ng (15 ph√∫t)
    
    section T = 0 ph√∫t
        T·∫°o ƒë∆°n h√†ng : Kh√°ch h√†ng t·∫°o ƒë∆°n
                     : Status = PENDING
                     : Message v√†o pending queue
                     : TTL timer b·∫Øt ƒë·∫ßu
    
    section T = 0-15 ph√∫t
        Ch·ªù thanh to√°n : Email nh·∫Øc nh·ªü g·ª≠i
                       : Timer ƒë·∫øm ng∆∞·ª£c
                       : Message trong queue
    
    section T = 5 ph√∫t (v√≠ d·ª•)
        Thanh to√°n th√†nh c√¥ng : Kh√°ch h√†ng thanh to√°n
                               : Status = PAID
                               : Message v√†o paid queue
                               : Timer d·ª´ng
    
    section T = 15 ph√∫t
        Message Expire : TTL h·∫øt h·∫°n
                       : N·∫øu ch∆∞a thanh to√°n
                       : Message chuy·ªÉn DLX
    
    section T = 15 ph√∫t + 1s
        T·ª± ƒë·ªông h·ªßy : Consumer nh·∫≠n expired message
                    : Check status != PAID
                    : Update status = CANCELLED
                    : Ho√†n tr·∫£ kho
                    : G·ª≠i email th√¥ng b√°o`,

            'rabbitmq': `graph LR
    subgraph "RabbitMQ Configuration"
        Exchange[order.exchange<br/>Type: Direct]
        DLX[order.dlx.exchange<br/>Type: Direct<br/>‚ö†Ô∏è Dead Letter Exchange]
        
        PendingQ["order.pending.queue<br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>x-message-ttl: 900000 (15 min)<br/>x-dead-letter-exchange: order.dlx.exchange<br/>x-dead-letter-routing-key: order.cancelled"]
        
        PaidQ["order.paid.queue<br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>Durable: true"]
        
        CancelledQ["order.cancelled.queue<br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>Durable: true"]
    end
    
    Exchange -->|"Binding<br/>routing-key: order.pending"| PendingQ
    Exchange -->|"Binding<br/>routing-key: order.paid"| PaidQ
    Exchange -->|"Binding<br/>routing-key: order.cancelled"| CancelledQ
    
    PendingQ -.->|"Message Expire<br/>After TTL"| DLX
    DLX -->|"DLX Binding<br/>routing-key: order.cancelled"| CancelledQ
    
    style Exchange fill:#fbbf24,stroke:#f59e0b,stroke-width:2px
    style DLX fill:#ef4444,color:#fff,stroke:#991b1b,stroke-width:3px
    style PendingQ fill:#fef3c7,stroke:#f59e0b,stroke-width:3px
    style PaidQ fill:#d1fae5,stroke:#10b981,stroke-width:3px
    style CancelledQ fill:#fee2e2,stroke:#ef4444,stroke-width:3px`
        };

        // Show diagram function
        function showDiagram(diagramId) {
            // Hide all diagrams
            document.querySelectorAll('.diagram-container').forEach(container => {
                container.classList.remove('active');
            });

            // Remove active from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected diagram
            document.getElementById(diagramId).classList.add('active');
            
            // Set active tab
            event.target.classList.add('active');

            // Render diagram if not already rendered
            const container = document.getElementById(diagramId);
            const content = container.querySelector('.diagram-content');
            
            if (content.querySelector('.loading')) {
                renderDiagram(diagramId, content);
            }
        }

        // Render diagram
        async function renderDiagram(diagramId, container) {
            try {
                const diagramCode = diagrams[diagramId].trim();
                
                if (!diagramCode || diagramCode.includes('<!--')) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #6b7280;">
                            <p>‚ö†Ô∏è Diagram ch∆∞a ƒë∆∞·ª£c load</p>
                            <p style="font-size: 14px; margin-top: 10px;">
                                Vui l√≤ng copy code t·ª´ file .mmd t∆∞∆°ng ·ª©ng v√† paste v√†o diagrams object trong script
                            </p>
                        </div>
                    `;
                    return;
                }

                const { svg } = await mermaid.render('mermaid-' + diagramId, diagramCode);
                container.innerHTML = svg;
            } catch (error) {
                console.error('Error rendering diagram:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ef4444;">
                        <p>‚ùå L·ªói khi render diagram</p>
                        <p style="font-size: 14px; margin-top: 10px;">${error.message}</p>
                    </div>
                `;
            }
        }

        // Load first diagram on page load
        window.addEventListener('load', () => {
            const firstContainer = document.querySelector('.diagram-container.active .diagram-content');
            renderDiagram('order-flow', firstContainer);
        });

        // Note: To use this file, you need to:
        // 1. Copy content from each .mmd file
        // 2. Paste into corresponding diagrams object property
        // 3. Remove the ```mermaid and ``` markers
        // 4. Save and open in browser
    </script>
</body>
</html>
